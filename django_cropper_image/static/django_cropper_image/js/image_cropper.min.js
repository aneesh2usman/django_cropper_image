!function(e){e.fn.CropperImage=function(t){var i={aspectratio_w:1,aspectratio_h:1,mincontainerwidth:300,mincontainerheight:300,mincanvasheight:300,mincanvaswidth:300,croprestrict:!1,mincropwidth:400,mincropheight:400,maxcropwidth:1200,maxcropheight:1200,filesize:.5,fileresolution:.7,fillcolor:"#fff",maxmainimagewidth:2e3,compress:!0,orginal_extension:!1};let a=this;a.default_ext="image/jpeg",a.settings={},a.coords=["h","w","x","y","r"],a.img_id=e(a).attr("id"),a.delete_image_id="#"+a.img_id.split(/_(.+)/)[1]+"-clear_id",a.container=document.querySelector("#"+a.img_id+"_img-ctr"),a.initiator={Cropper:window.Cropper,URL:window.URL||window.webkitURL,container_div:e("#"+a.img_id+"-img-ctr-div"),image:a.container.getElementsByTagName("img").item(0),actions:document.getElementById(a.img_id+"-actions"),data_h:e("#"+a.img_id+"_h").val(),data_w:e("#"+a.img_id+"_w").val(),data_x:e("#"+a.img_id+"_x").val(),data_y:e("#"+a.img_id+"_y").val(),data_r:e("#"+a.img_id+"_r").val(),full_img_val:e("#"+a.img_id+"_full").val(),defaultCrop:{}},a.originalImageURL=a.initiator.image.src,a.uploadedImageType="image/jpeg",a.uploadedImageName="cropped.jpg",a.uploadedImageURL,a.getDefault=function(){return null==t&&(t=a.data()),a.settings=e.extend({},i,t)},a.init=function(){a.getDefault(),a.initiator.data_h&&a.initiator.data_w&&a.initiator.data_x&&a.initiator.data_y&&(a.initiator.defaultCrop={width:parseFloat(a.initiator.data_w),height:parseFloat(a.initiator.data_h),x:parseFloat(a.initiator.data_x),y:parseFloat(a.initiator.data_y),rotate:parseFloat(a.initiator.data_r)}),a.crop_options={data:a.initiator.defaultCrop,zoomable:!0,aspectRatio:parseInt(a.settings.aspectratio_w)/parseInt(a.settings.aspectratio_h),preview:"#"+a.img_id+"-img-preview",minContainerWidth:a.settings.mincontainerwidth,minContainerHeight:a.settings.mincontainerheight,ready:function(e){a.setMinMaxCrop()},cropstart:function(t){e(t.target);a.setMinMaxCrop()},cropmove:function(t){e(t.target),a.cropper.getCropBoxData();return mincrop=a.setMinMaxCrop(),1!=mincrop},cropend:function(t){Coordinates=a.GetCoordinates(),a.SetCoordinates(Coordinates),e("#"+a.img_id+"_cropped").val(a.getCanvas()),e(a.delete_image_id+"_delete").attr("checked","checked")},crop:function(e){e.detail},zoom:function(t){setTimeout(function(){Coordinates=a.GetCoordinates(),a.setMinMaxCrop(),a.SetCoordinates(Coordinates),e("#"+a.img_id+"_cropped").val(a.getCanvas()),e(a.delete_image_id+"_delete").attr("checked","checked")},500)}},a.initiator.full_img_val?(a.initiator.image.src=a.initiator.full_img_val,a.showHideConainer(a.container,a.img_id)):(a.initiator.image.src="",a.showHideConainer(a.container,a.img_id,!1)),a.cropper=a.cropperobj(),a.CropperInit()},a.getCanvas=function(e=a.settings,t=a.default_ext){return canvas="",console.log("*********getCanvas*settings********8",e,e.orginal_extension,t),1==e.orginal_extension&&a.uploadedImageType!=a.default_ext?canvas=a.cropper.getCroppedCanvas().toDataURL():canvas=a.cropper.getCroppedCanvas(a.canvas_option(e)).toDataURL(t),canvas},a.cropperobj=function(){return a.cropper=new a.initiator.Cropper(a.initiator.image,a.crop_options),a.cropper.destroy(),a.cropper=null,e(a.container).children(".cropper-container").remove(),a.cropper=new a.initiator.Cropper(a.initiator.image,a.crop_options),a.cropper},a.showHideConainer=function(t,i,o=!0){o?(a.initiator.container_div.show(),e(a.container).show(),e("#"+a.img_id+"-actions").show()):(a.initiator.container_div.hide(),e(a.container).hide(),e("#"+a.img_id+"-actions").hide())},a.CropperInit=function(){document.createElement("canvas").getContext||e('button[data-method="getCroppedCanvas"]').prop("disabled",!0),void 0===document.createElement("cropper").style.transition&&(e('button[data-method="rotate"]').prop("disabled",!0),e('button[data-method="scale"]').prop("disabled",!0)),a.initiator.actions.querySelector(".action-buttons").onclick=function(t){var i,o,r,n,s=t||window.event,c=s.target||s.srcElement;if(a.cropper){for(;c!==this&&!c.getAttribute("data-method");)c=c.parentNode;if(!(c===this||c.disabled||c.className.indexOf("disabled")>-1)&&(n={method:c.getAttribute("data-method"),target:c.getAttribute("data-target"),option:c.getAttribute("data-option")||void 0,secondOption:c.getAttribute("data-second-option")||void 0},i=a.cropper.cropped,n.method)){if(void 0!==n.target&&(r=document.querySelector(n.target),!c.hasAttribute("data-option")&&n.target&&r))try{n.option=JSON.parse(r.value)}catch(s){console.log(s.message)}switch(n.method){case"rotate":i&&a.crop_options.viewMode>0&&a.cropper.clear();break;case"delete":alert("ghghghhg"),i&&a.crop_options.viewMode>0&&a.cropper.clear();break;case"getCroppedCanvas":try{n.option=JSON.parse(n.option)}catch(s){console.log(s.message)}"image/jpeg"===a.uploadedImageType&&(n.option||(n.option={}),n.option.fillColor="#FFFFFF")}switch(o=a.cropper[n.method](n.option,n.secondOption),n.method){case"rotate":Coordinates=a.GetCoordinates(),a.SetCoordinates(Coordinates),setTimeout(function(){e("#"+a.img_id+"_cropped").val(a.getCanvas()),e(a.delete_image_id+"_delete").attr("checked","checked")},400),i&&a.crop_options.viewMode>0&&a.cropper.crop();break;case"move":Coordinates=a.GetCoordinates(),a.SetCoordinates(Coordinates),e("#"+a.img_id+"_cropped").val(a.getCanvas()),e(a.delete_image_id+"_delete").attr("checked","checked");break;case"reset":Coordinates=a.GetCoordinates(),a.SetCoordinates(Coordinates),e("#"+a.img_id+"_cropped").val(a.getCanvas()),e(a.delete_image_id+"_delete").attr("checked","checked"),mincrop=a.setMinMaxCrop();break;case"disable":a.deleteImage();break;case"scaleX":case"scaleY":c.setAttribute("data-option",-n.option);break;case"destroy":alert("fggfgf"),a.cropper=null,a.uploadedImageURL&&(URL.revokeObjectURL(a.uploadedImageURL),a.uploadedImageURL="",a.initiator.image.src=originalImageURL)}if("object"==typeof o&&o!==a.cropper&&r)try{r.value=JSON.stringify(o)}catch(s){console.log(s.message)}}}},document.body.onkeydown=function(e){var t=e||window.event;if(t.target===this&&a.cropper&&!(this.scrollTop>300))switch(t.keyCode){case 37:t.preventDefault(),a.cropper.move(-1,0);break;case 38:t.preventDefault(),a.cropper.move(0,-1);break;case 39:t.preventDefault(),a.cropper.move(1,0);break;case 40:t.preventDefault(),a.cropper.move(0,1)}},URL?e(a).change(function(){var e,t=this.files;if(a.cropper&&t&&t.length)if(e=t[0],imagevalidate=a.imageValidations(e),"success"==imagevalidate.status)if(e&&/^image\/\w+/.test(e.type))try{a.uploadedImageType=e.type,uploadedImageName=e.name,"compress"==imagevalidate.action?a.compressImage(e,a):a.ordinaryImage(e)}catch(e){a.throwImgException(e)}else a.throwImgException("Please choose an image file.");else a.throwImgException(imagevalidate.message)}):(inputImage.disabled=!0,inputImage.parentNode.className+=" disabled")},a.GetCoordinates=function(){var e={};return value=a.cropper.getData(),e.x=value.x.toFixed(2),e.y=value.y.toFixed(2),e.w=value.width.toFixed(2),e.h=value.height.toFixed(2),e.r=value.rotate.toFixed(2),e},a.SetCoordinates=function(t){e.each(a.coords,function(i,o){e("#"+a.img_id+"_"+o).val(t[o])})},a.checkFileSize=function(e){return filesize=(e.size/1024/1024).toFixed(2)},a.ordinaryImage=function(t){a.uploadedImageURL&&URL.revokeObjectURL(a.uploadedImageURL);let i=window.URL||window.webkitURL;!function(e,t){let a=new Image;a.onload=function(){t&&t(a)},a.src=i.createObjectURL(e)}(t,function(t){try{if(a.setDisplay(),t.width<parseFloat(a.settings.mincropwidth)||t.height<parseFloat(a.settings.mincropheight))throw"Please upload image minimum width "+a.settings.mincropwidth+"px and minimum height"+a.settings.mincropheight+"px";a.initiator.image.src=t.src,a.cropper.destroy(),a.cropper=new a.initiator.Cropper(a.initiator.image,a.crop_options),setTimeout(function(){Coordinates=a.GetCoordinates(),a.SetCoordinates(Coordinates),full_image=a.convertImage(t),e("#"+a.img_id+"_full").val(full_image),e("#"+a.img_id+"_cropped").val(a.getCanvas())},400)}catch(e){a.throwImgException(e)}})},a.throwImgException=function(t){var i=e("#"+a.img_id);i.wrap("<form>").closest("form").get(0).reset(),i.unwrap(),window.alert(t)},a.setDisplay=function(){a.showHideConainer(a.container,a.img_id,!0),e(a.delete_image_id+"_delete").attr("checked","checked"),e(a.delete_image_id).removeAttr("checked"),e(a.delete_image_id+"_deleteonly").removeAttr("checked")},a.convertImage=function(e,t="compress",i=a.settings,o=a.default_ext){var r=document.createElement("canvas"),n=r.getContext("2d");return comps_ratio=1,"compress"==t&&e.width>=parseFloat(i.maxmainimagewidth)&&(comps_ratio=e.width/parseFloat(i.maxmainimagewidth)),console.log("**********imagefggfg******"),r.width=e.width/comps_ratio,r.height=e.height/comps_ratio,n.drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),1==i.orginal_extension&&(o=a.uploadedImageType),compres="compress"==t?r.toDataURL(o,i.fileresolution):r.toDataURL(o),compres},a.compressImage=function(t){var i=new FileReader;i.readAsDataURL(t),i.addEventListener("load",function(t){var i=new Image;i.onload=function(){a.setDisplay(),compres=a.convertImage(i,type="compress"),a.initiator.image.src=a.uploadedImageURL=compres,a.cropper.destroy(),a.cropper=new a.initiator.Cropper(a.initiator.image,a.crop_options),setTimeout(function(){Coordinates=a.GetCoordinates(),a.SetCoordinates(Coordinates),e("#"+a.img_id+"_full").val(a.initiator.image.src),e("#"+a.img_id+"_cropped").val(a.getCanvas())},400)},i.src=t.target.result})},a.imageValidations=function(e){let t={status:"success",action:null,message:"success"};try{if(size=a.checkFileSize(e),size>parseFloat(a.settings.filesize)&&1==a.settings.compress)t={status:"success",action:"compress",message:"success"};else if(size>parseFloat(a.settings.filesize)&&1!=a.settings.compress)throw"Max file upload size "+a.settings.filesize+" MB"}catch(e){t={status:"failed",action:null,message:e}}return t},a.setMinMaxCrop=function(){var e=a.cropper.getCropBoxData(),t=a.cropper.getImageData(),i=a.cropper.getCanvasData();return canvas_width=t.naturalWidth/i.width,canvas_height=t.naturalHeight/i.height,cropped_width=e.width*canvas_width,cropped_height=e.height*canvas_height,flag=0,1==a.settings.croprestrict&&(parseInt(a.settings.aspectratio_w)>parseInt(a.settings.aspectratio_h)?(parseFloat(cropped_width)<=parseFloat(a.settings.mincropwidth)&&(e.width=parseFloat(a.settings.mincropwidth)/canvas_width,flag=1),parseFloat(cropped_width)>parseFloat(a.settings.maxcropwidth)&&(e.width=parseFloat(a.settings.maxcropwidth)/canvas_width,flag=1)):a.settings.aspectratio_w<a.settings.aspectratio_h?(parseFloat(cropped_height)<=parseFloat(a.settings.mincropheight)&&(e.height=parseFloat(a.settings.mincropheight)/canvas_height,flag=1),parseFloat(cropped_height)>=parseFloat(a.settings.maxcropheight)&&(e.height=parseFloat(a.settings.maxcropheight)/canvas_height,flag=1)):(parseFloat(cropped_height)<=parseFloat(a.settings.mincropheight)&&(e.height=parseFloat(a.settings.mincropheight)/canvas_height,flag=1),parseFloat(cropped_height)>parseFloat(a.settings.maxcropheight)&&(e.height=parseFloat(a.settings.maxcropheight)/canvas_height,flag=1)),1==flag&&a.cropper.setCropBoxData(e)),flag},a.deleteImage=function(){var t="#"+a.img_id.split(/_(.+)/)[1]+"-clear_id";e(t+"_delete").attr("checked","checked"),e(t).attr("checked","checked"),e(t+"_deleteonly").attr("checked","checked"),a.showHideConainer(a.container,a.img_id,!1),e("#"+a.img_id+"_full").val(""),e("#"+a.img_id+"_cropped").val(""),a.cropper.destroy();var i=e("#"+a.img_id);i.wrap("<form>").closest("form").get(0).reset(),i.unwrap()},a.canvas_option=function(e){return canvas_data={fillColor:e.fillcolor},canvas_data},a.init()}}(jQuery),$(document).find("[cropper-image]").each(function(){$(this).CropperImage()});